<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location-based Attendance System</title>
</head>
<body>
    <h1>Location-based Attendance System</h1>
    <button id="set-location">Set Initial Location</button>
    <button id="check-location" disabled>Check Location</button>
    <div id="status"></div>
    <div id="initial-coordinates"></div>
    <div id="current-coordinates"></div>

    <script>
        let initialCoordinates = null;
        const radius = 50; // Radius in meters

        document.getElementById('set-location').addEventListener('click', function() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(setInitialLocation, errorCallback);
            } else {
                alert('Geolocation is not supported by this browser.');
            }
        });

        document.getElementById('check-location').addEventListener('click', function() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(checkLocation, errorCallback);
            } else {
                alert('Geolocation is not supported by this browser.');
            }
        });

        function setInitialLocation(position) {
            initialCoordinates = {
                latitude: position.coords.latitude,
                longitude: position.coords.longitude
            };
            document.getElementById('initial-coordinates').innerText = 
                `Initial Coordinates: Latitude: ${initialCoordinates.latitude}, Longitude: ${initialCoordinates.longitude}`;
            document.getElementById('status').innerText = 'Initial location set.';
            document.getElementById('check-location').disabled = false;
        }

        function checkLocation(position) {
            if (!initialCoordinates) {
                document.getElementById('status').innerText = 'Initial location not set.';
                return;
            }

            const userLat = position.coords.latitude;
            const userLng = position.coords.longitude;

            document.getElementById('current-coordinates').innerText = 
                `Current Coordinates: Latitude: ${userLat}, Longitude: ${userLng}`;
            
            const distance = calculateDistance(userLat, userLng, initialCoordinates.latitude, initialCoordinates.longitude);
            
            if (distance <= radius) {
                document.getElementById('status').innerText = 'You are within the radius of the initial location.';
            } else {
                document.getElementById('status').innerText = 'You are not within the radius of the initial location.';
            }
        }

        function errorCallback(error) {
            console.error(error);
            document.getElementById('status').innerText = 'Error fetching location.';
        }

        // Haversine formula to calculate the distance between two coordinates in meters
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371e3; // Earth radius in meters
            const φ1 = lat1 * Math.PI / 180;
            const φ2 = lat2 * Math.PI / 180;
            const Δφ = (lat2 - lat1) * Math.PI / 180;
            const Δλ = (lon2 - lon1) * Math.PI / 180;

            const a = Math.sin(Δφ / 2) * Math.sin(Δφ / 2) +
                      Math.cos(φ1) * Math.cos(φ2) *
                      Math.sin(Δλ / 2) * Math.sin(Δλ / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

            const distance = R * c;

            return distance;
        }
    </script>
</body>
</html>
